<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<%
	request.setAttribute("ctx", request.getContextPath());
	String path = request.getContextPath();
	String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";

%>

<html>
<title>登录</title>
<%@ include file="../../../common/common.jsp"%>
<base href="<%=basePath%>">
<head>
<link href="${ctx}/workflow/js/uploadify/themes/default.css" rel="stylesheet" type="text/css" />
<link href="${ctx}/workflow/js/uploadify/themes/uploadify.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="${ctx}/workflow/js/uploadify/jquery.uploadify.v2.1.4-min.js"></script>
<script type="text/javascript" src="${ctx}/workflow/js/uploadify/swfobject.js"></script>
<script type="text/javascript" src="${ctx}/workflow/js/uploadify/jquery.uploadify.v2.1.4.js"></script>
<script type="text/javascript" src="${ctx}/workflow/js/uploadify/org_domain_lang_zh.js"></script>

<script type="text/javascript">
	function login() {
		var json = {
			"userId" : $("#user_id").val(),
			"userName" : $("#user_id").find("option:selected").text(),
			"deptId" : "1",
			"deptName" : "产品开发部",
			"tenantId" : $("#wf_tenantId").val(),
			"tenantName" : "zywx",
			"suffix" : "/workflow/formList"
		};

		var con = JSON.stringify(json);
		$.ajax({
			type : "post",
			url : "http://localhost:8080/appdo-web-flow/initLogin/init",
			contentType : "application/json",
			data : con,
			success : function(data) {
			},
			error : function(error) {
			}
		});
	}
	//提交保存操作
	function submit(op) {
		var json = {"tenantId":$("#wf_tenantId").val(),
				"entityTypeId":"24",
				"entity":{
					"input_date":"2015-11-13",
					"dept":"企业级移动应用研发部",
					"user_info":$("#user_id").find("option:selected").text(),
					"oper_type":"2",
					"reason_info":"出差，去约会",
					"dept_opinion":"",
					"hr_opinion":"",
					"dgm_opinion":"",
					"gm_opinion":"",
					"now_dept_user":"ZY0889",
					"now_bgm_user":"ZY0024",
					"billKey":$("#wf_billkey").val(),
					"metaid":$("#wf_metaid").val(),
					"userType":"员工1"//,//分管副总经理  部门负责人
					//"countday":3,
					//"busicode":002},
					},
				"operateUserId":$("#user_id").val(),
				"userId":$("#user_id").val(),
				"userType":"员工1",
				"entityId":"E150f56771da3139",
				"operateTypeId":"01",
				"objectId":new Date(),
				"createdAt":"2015-11-11T07:20:34.079Z"
				};
		var con = JSON.stringify(json);
		$.ajax({
			type : "post",
			url : "http://localhost:8080/appdo-web-flow/workFlowAction/saveForm/"+op,
			contentType : "application/json",
			data : con,
			success : function(data) {
				alert(data.info);
			},
			error : function(error) {
			}
		});
	}
	//我提交的单据类型
	function getMySubmitList() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"billKey" : $("#wf_billkey").val(),
			"metaid" : "",
			"rowCnt" : "10",
			"pageNo" : "1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getMySubmitList",
					contentType : "application/json",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	//获取模板数据
	function getModel() {
		var json = {
			"tenantId" :$("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"billKey" : $("#wf_billkey").val(),
			"metaid" : $("#wf_metaid").val(),
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",//getBillTypeList getBillTypeFileById getBillTypeTemplateFileds
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getBillTypeFileById",
					contentType : "application/json",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}

	//获取单据类型数据
	function getBillTypeList() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : "",
			"billKey" : "",
			"metaid" : ""
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",//getBillTypeList getBillTypeFileById getBillTypeTemplateFileds
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getBillTypeList",
					contentType : "application/json",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//获取单据类型字段信息
	function getBillTypeTemplateFileds() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : "",
			"billKey" : $("#wf_billkey").val(),
			"metaid" : $("#wf_metaid").val(),
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",//getBillTypeList getBillTypeFileById getBillTypeTemplateFileds
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getBillTypeTemplateFileds",
					contentType : "application/json",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//获取草稿箱数据
	function getDraftList() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"rowCnt" : "30",
			"pageNo" : "1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getDraftList",
					contentType : "application/json",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}

	//获取进行中流程实例
	function getProcessInstanceList() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"rowCnt" : "10",
			"pageNo" : "1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getProcessInstanceList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//获取已完成流程实例
	function getProcessInstanceHisList() {
		var json = {
			"tenantId" :$("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"metaid" : $("#wf_metaid").val(),
			"prco_inset_id" :$("#wf_processId").val(), 
			"rowCnt" : "30",
			"pageNo" : "1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getProcessInstanceHisList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//获取历史审批数据
	function getHistoryList() {
		var json = {
			"tenantId" :$("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"metaid" : $("#wf_metaid").val(),
			"prco_inset_id" : $("#wf_processId").val(),
			"rowCnt" : "30",
			"pageNo" : "1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getHistoryList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//获取代签收列表
	function getClaimList() {
		var json = {
			"tenantId" :$("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"metaid" : "",
			"prco_inset_id" : "",
			"rowCnt" : "30",
			"pageNo" : "1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getClaimList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//获取待办数据
	function getTodoList() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"rowCnt" : "30",
			"pageNo" : "1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getTodoList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//获取已办数据
	function getApprovedList() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"metaid" : $("#wf_metaid").val(),
			"prco_inset_id" : "",
			"rowCnt" : "30",
			"pageNo" : "1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getApprovedList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//签收任务
	function claimTask() {
		var json = {
			"tenantId" :$("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"taskId" : $("#wf_taskid").val()
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowAction/claimTask",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data.info);
					},
					error : function(error) {
					}
				})
	}
	//提交任务
	function commitTask() {
		var json = {
				"tenantId" : $("#wf_tenantId").val(),
				"userId" : $("#user_id").val(),
				"taskId" : $("#wf_taskid").val(),
				"approve":"true",
				"approveResult":"同意...."
		}
		var data = JSON.stringify(json)
		$.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowAction/commitTask",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data.info);
					},
					error : function(error) {
					}
				})
	}
	
	//流程定义信息
	function getProcessDefList() {
		var json = {
				"tenantId" : $("#wf_tenantId").val(),
				"userId" : $("#user_id").val(),
				"metaid" : "",
				"prco_inset_id" : $("#wf_processId").val(),
				"rowCnt" : "30",
				"pageNo" : "1"
			}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getProcessDefList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//流程定义信息
	function delDraftData() {
		var json = {
				"tenantId" : $("#wf_tenantId").val(),
				"businessKey" : "56455959865ccdd1743b3f84",
			}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowAction/delDraftData",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	//流程定义信息
	function getToRejectTaskList() {
		var json = {
				"prco_inset_id" : $("#wf_processId").val(),
			}
		var data = JSON.stringify(json)
		$.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getToRejectTaskList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data.info);
					},
					error : function(error) {
					}
				})
	}
	
	
	/**
	*是否办结查询
	*/
	function getMyInvolvedProcList(isEnd) {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"metaid" : $("#wf_metaid").val(),
			"rowCnt" : "10",
			"pageNo" : "1",
			"isFinished":isEnd
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getMyInvolvedProcList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	function getMyProcList(fin) {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"metaid" : $("#wf_metaid").val(),
			"prco_inset_id" : "",
			"rowCnt" : "30",
			"pageNo" : "1",
			"isFinished":fin
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getProcessInstanceList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	//收回
	function backTask() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"prco_inset_id" : $("#wf_processId").val(),
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowAction/backTask",
					contentType : "application/json",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	//驳回
	function rejectTask() {
		var json = {
			"tenantId" : $("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"prco_inset_id" : "",
			"targetTaskKey":"",
			"approveResult":""
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowAction/rejectTask",
					contentType : "application/json",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	
	function getProcIMG() {
		var json = {
			"prco_inset_id" : $("#wf_processId").val(),
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getFlowImage",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	
	function rejectTask() {
		var json = {
			"targetTaskKey" : "17508",
			"taskId" : $("#wf_taskid").val(),
			"tenantId":$("#wf_tenantId").val()
		
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowAction/rejectTask",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	
	//获取被退回数据
	function getTodoList_back() {
		var json = {
			"tenantId" :$("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"rowCnt" : "10",
			"pageNo" : "1",
			"isback":"1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getCommitBackToMyProcList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	//获取我收回数据
	function getTodoList_revoke() {
		var json = {
			"tenantId" :$("#wf_tenantId").val(),
			"userId" : $("#user_id").val(),
			"rowCnt" : "10",
			"pageNo" : "1",
			"isrevoke":"1"
		}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getRevokeBackToMyProcList",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	//流程定义信息
	function getTaskOpinionFieldByTaskIdAndFlowId() {
		var json = {
				"wf_tenantId" : $("#wf_tenantId").val(),
				"wf_taskid" : $("#wf_taskid").val(),
				"wf_metaid" :  $("#wf_metaid").val(),
				"wf_billkey" :  $("#wf_billkey").val()
			}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getTaskOpinionFieldByTaskIdAndFlowId",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	//流程定义信息
	function traceProcess(){ 
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workflow/process/trace/"+$("#wf_processId").val(),
					contentType : "application/json;charset=UTF-8",
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
	
	//查看信息
	function getProcessOverByParamMap() {
		var json = {
				"objectIds" : "5668e36d91be1cd60e11fcf8,5667048e590ae419362a5c70,5668ecd091be1cd60e11fcfb,5668f36a91be1cd60e11fcff",
				"opType":2,
				"tenantId":611
			}
		var data = JSON.stringify(json)
		$
				.ajax({
					type : "post",
					url : "http://localhost:8080/appdo-web-flow/workFlowData/getProcessOverByParamMap",
					contentType : "application/json;charset=UTF-8",
					data : data,
					success : function(data) {
						alert(data);
					},
					error : function(error) {
					}
				})
	}
</script>
</head>
<body>
		<br/>
		<input type="button" id="login" value="登录" onclick="login()" /> 
	<div>
	<br/>
		<input type="button" id="getModel" value="单据模板" onclick="getModel()" />
		<input type="button" id="getBillTypeList" value="单据类型列表" onclick="getBillTypeList()" />
		<input type="button" id="getBillTypeTemplateFileds" value="单据类型字段" onclick="getBillTypeTemplateFileds()" />
	</div>
	<div>
	<br/>
	
		<input type="button" id="getDraftList" value="草稿数据" onclick="getDraftList()" />
		<input type="button" id="getClaimList" value="待签收" onclick="getClaimList()" /> 
		<input type="button" id="getTodoList" value="待办理" onclick="getTodoList()" />
		<input type="button" id="getApprovedList" value="已办理" onclick="getApprovedList()" />
		<input type="button" id="getHistoryList" value="审批轨迹" onclick="getHistoryList()" />
		<input type="button" id="getProcessInstanceList" value="流转中" onclick="getProcessInstanceList()" />
		<input type="button" id="traceProcess" value="输出跟踪流程信息" onclick="traceProcess()" />
	</div>
	<div>
	<br/>
		<input type="button" id="submit" value="保存" onclick="submit(0)" />
		<input type="button" id="submit" value="提交" onclick="submit(1)" />
		<input type="button" id="claimTask" value="签收" onclick="claimTask()" />
		<input type="button" id="commitTask" value="办理" onclick="commitTask()" />
		<input type="button" id="backTask" value="收回" onclick="backTask()" />
		<input type="button" id="rejectTask" value="驳回" onclick="rejectTask()" />
		<input type="button" id="delDraftData" value="删除草稿" onclick="delDraftData()" />
		<input type="button" id=getTaskOpinionFieldByTaskIdAndFlowId value="查询当前签章意见字段" onclick="getTaskOpinionFieldByTaskIdAndFlowId()" />
	</div>
	<div>
		<input type="button" id="getMySubmitList" value="我提交的单据" onclick="getMySubmitList()" />
		<input type="button" id="myBackTask" value="被退回的单据" onclick="getTodoList_back()" />
		<input type="button" id="myRevokeData" value="我收回的单据" onclick="getTodoList_revoke()" />
		<input type="button" id="getProcessDefList" value="查询流程定义信息" onclick="getProcessDefList()" />
		<input type="button" id="getToRejectTaskList" value="可驳回列表" onclick="getToRejectTaskList()" />
		<input type="button" id="getFlowImage" value="流程图" onclick="getProcIMG()"/>
		<input type="button" id="getMyInvolvedProcList" value="我发起的已办结流程" onclick="getMyInvolvedProcList(1)" />
		<input type="button" id="getMyInvolvedProcList" value="我发起的未办结流程" onclick="getMyInvolvedProcList(0)" />
		
	</div>
	<div>
	<br/>
	<br/>
	<div>
	<b>操作人员：</b>
		<select id="user_id">
			<option value="ZY0502" selected>苏荣秋</option>
			<option value="ZY0315">李文</option>
			<option value="ZY0804">人力资源</option>
			<option value="ZY0001">王国春</option>
			<option value="ZY0057">杜辉</option>
			<option value="ZY0024">陈雪</option>
			<option value="ZY0742">找一号</option>
			<option value="ZY0889">ZY0889</option>
		</select>
	</div>
	<div>
		<b>当前任务 TaskId：</b>
		<input id="wf_taskid" name="wf_taskid"><br/>
		<b>当前元数据模型 metaId：</b>
		<input id="wf_metaid" name="wf_metaid" value="33"><br/>
		<b>当前流程 billkey：</b>
		<input id="wf_billkey" name="wf_billkey" value="54"><br/>
		<b>当前租户 tenantId：</b>
		<input id="wf_tenantId" name="wf_tenantId" value="611"><br/>
		<b>当前流程实例  processId：</b>
		<input id="wf_processId" name="wf_processId" value="">
	</div>
	<div>
	<br/>
		<input type="button" value="查询考勤-招聘数据" onclick="getProcessOverByParamMap()">
	<br/>
	</div>
	<br/>
	<a href="/appdo-web-flow/settingMeta/metaCustomList">元数据管理-管理后台</a>
	<br>
	<a href="/appdo-web-flow/settingModel/modelList">模型管理-管理后台</a>
	<br>
	<a href="/appdo-web-flow/workflow/formList">测试表单</a>
	<br>
	<a href="/appdo-web-flow/workflow/draftList">草稿箱</a>
	<br>
	<a href="/appdo-web-flow/workflow/claimList">待签收</a>
	<br>
	<a href="/appdo-web-flow/workflow/todoList">待办理</a>
	<br>
	<a href="/appdo-web-flow/workflow/approvedList">已办</a>
	<br>
	<a href="/appdo-web-flow/workflow/submitList">我的单据</a>
	<br>
	<a href="/appdo-web-flow/workflow/processInstanceList">管理员流程跟踪</a>
	</div>
	
	
</body>
</html>